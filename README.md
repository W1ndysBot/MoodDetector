# MoodDetector (心情检测器)

基于大模型的群聊心情检测娱乐功能，通过分析用户的聊天记录来推测用户的心情状态。

## 功能特点

- 自动收集并分析群成员的聊天记录
- 基于用户活跃度动态调整消息采样数量
- 智能冷却机制，避免过于频繁的检测
- 随机触发机制，增加趣味性
- 支持群管理员控制开关

## 使用方法

### 基础命令

- `md` - 切换心情检测功能的开/关状态（仅管理员可用）

### 触发机制

系统会自动收集用户的聊天记录，当满足以下条件时可能触发心情检测：

1. 消息数量达到阈值（根据活跃度决定）：
   - 活跃度 > 50: 10条消息
   - 活跃度 > 20: 7条消息
   - 其他情况: 5条消息

2. 距离上次检测超过60秒

3. 50%的随机触发概率

## 响应格式

检测结果将以回复形式发送，包含：
- 心情分析结果
- Token 使用量
- 调用成本

## 注意事项

1. 功能需要管理员权限开启
2. 为避免打扰，设有冷却时间和随机触发机制
3. 消息存储上限会随用户活跃度动态调整
4. 仅在功能开启状态下记录分析消息

## 技术实现

- 使用 Dify.AI 作为底层大语言模型服务
- 采用异步处理机制
- 基于用户活跃度的动态消息管理
- 分布式消息存储系统
